### 강의 정리 - 01. 인터넷 네트워크

HTTP는 인터넷 네트워크망에 기반한다.
한국에 사는 내가 미국에 있는 친구에게 메세지를 보내려 한다. 하지만 인터넷 망은 매우 복잡하다. 어떻게 메세지가 보내지는 걸까? 이를 위해 "IP, 즉 인터넷 프로토콜"에 대해 살펴보자.

<br />

#### 1. IP(인터넷 프로토콜)

우선 클라이언트인 '나'가 IP 주소(100.100.100.1)를 부여받아야 한다. 그리고 친구의 IP 주소(200.200.200.2)도 서버에 있어야 한다.

IP(인터넷 프로토콜)은 지정한 IP주소에 데이터를 전달하는데 이때, 패킷이라는 통신 단위로 데이터를 전달한다. 우선 내 IP주소와 친구의 IP주소, 메세지와 함께 묶어 IP패킷을 만든 후에 인터넷 망에 던진다. IP 프로토콜에 의해서 서버들이 규약을 따르는데, 출발지와 목적지를 확인해서 노드들이 서로 패킷을 던져 최종 목적지를 찾는다.

하지만 이 방식으로는 한계가 있다.

1. 비연결성
   - 패킷을 받을 대상이 없거나 서비스 불능 상태여도 패킷 전송
2. 비신뢰성
   - 중간에 패킷이 사라지면?
   - 혹은 여러 패킷들이 순서대로 안 오면?
3. 프로그램 구분
   - 같은 IP를 사용하는 서버에서 통신하는 애플리케이션이 둘 이상이면?

---

<br />

#### 2. TCP 프로토콜

이러한 문제점을 TCP 프로토콜이 해결할 수 있다. IP 위에 TCP를 올려 살짝 보완해준다고 보면 된다.

친구한데 메세지를 보낸다고 가정하자. 그러면 애플리케이션인 채팅 프로그램을 통해 메시지를 생성한다. 그러면 메세지를 SOCKET 라이브러리를 통해 OS(운영체제) 계층에 전달한다. OS 계층에서 TCP는 메세지에다가 TCP 정보를 씌우고(초록색) 한칸 아래로 내려간다. TCP 계층 밑에는 IP 계층이 있다. 여기서 IP는 IP관련 정보를 그 위에 씌워서(노란색) 이렇게 IP 패킷이 생성된다. 그리고 네트워크 인터페이스 계층의 랜카드를 통해서 나갈 때, 이더넷 프레임(Ethernet frame)이 포함되서 나간다. 이더넷 프레임은 랜카드에 등록된 맥주소와 같은 물리적인 정보를 포함하고 있다.

IP 패킷에는 출발지IP, 목적지IP 등이 있고, 그 안에 있는 TCP 패킷에는 IP에선 없던 출발지 PORT, 목적지 PORT, 전송제어, 순서, 검증 정보, 그리고 그 안에 실제 전송 정보가 있다.

<br />

#### 2-1. TCP 프로토콜의 특징

TCP의 특징을 우선 살펴보자. TCP는 전송 제어 프로토콜이다. 여기에는 크게 세 가지 특징이 있는데,

1. 연결 지향 - TCP 3 way handshake(가상 연결)

   - 메세지를 먼저 보내는 게 아니라, 연결부터 해서 연결 여부를 살펴본 다음 메세지를 보낸다.

2. 데이터 전달 보증

   - 만약 메세지를 잘 받았다면 서버가 클라이언트한테 메세지 받았다고 알려줌
   - 만약 패킷이 중간에 누락된다면 그 사실을 알 수 있다.

3. 순서 보장

4. 신뢰할 수 있는 프로토콜
5. 현재는 대부분 TCP 사용

<br />

##### 2-1-1. 연결 지향 - TCP 3 way handshake(가상 연결)

우선 클라이언트에서 서버로 SYN 이란 접속 요청 메세지를 보낸다. 그러면 서버에서 요청을 수락했다는 ACK라는 메세지와 함께 '나도 연결해줘!'라는 SYN를 클라이언트에 보낸다. 그러면 클라이언트도 ACK를 보낸다. 이렇게 서로 연결이 되면 그 다음에 데이트를 전송한다. (요즘은 3번 ACK와 함께 바로 데이터를 전송하기도 한다) 그런데 이 쓰리 위에 핸드섀이크는 실제로 연결되는 게 아니라 개념적으로, 논리적으로 연결이 된 것. 실제로 수많은 서버의 노드들이 연결이 되었는지는 여부는 모른다. 그냥 연결이 됐다고 하니 '아, 연결 됐겠네' 라고 생각하는 것.

##### 2-1-3. 순서 보장

패킷 1,2,3 순서로 가야하는데 1,3,2로 갔다. 그러면 서버는 '2번부터 잘못됐구나' 싶어서 잘못 전송된 2번부터 폐기한 후, 클라이언트한테 다시 패킷2번부터 다시 보내라고 요청한다.
(물론 알아서 순서대로 조절을 한다던가 제대로 전송된 것들은 따로 보관하는 등 최적화를 할 수도 있다.)

---

<br />

#### 3. UDP 특징

사용자 데이터그램 프로토콜. UDP는 TCP와 같은 계층에 있고 IP 바로 위에 있다. UPD는 별다른 기능이 없다. 거의 IP와 비슷하다. 다만 거기에 PORT와 체크섬이 추가된다. PORT란 무엇일까? 예를 들어 한 컴퓨터에 게임과 음악 스트리밍을 돌린다고 가정하자. 내 컴퓨터는 하나라서 IP는 단 하나이다. 그런데 이 하나의 IP에 여러가지 패킷이 들어오게 된다. 여기서 애플리케이션들이 게임용이나 음악용 패킷을 구분하기 위해 PORT를 이용한다. 체크섬은 메세지에 대해서 맞는지 제대로 검증해주는 역할을 한다. TCP는 쓰리웨이 섀이킹을 해야하니 시간이 많이 걸리고 데이터 양도 커서 전송 속도가 빠를 수 없다. 이럴 때 UDP를 통하면 최적화를 할 수 있다. 현재는 TCP가 거의 대부분을 차지하고 있지만 최근에는 UDP가 각광받고 있다. 최근에 HTTP3 스펙이 나왔는데 여기서 SYN과 ACK를 줄여보자는 최적화를 하면서 UDP를 쓰고 있는데 그래서 뜨고 있다.

---

<br />

#### 4. PORT

한번에 둘 이상을 연결해야 한다면? 클라이언트가 한번에 여러 서버와 통신을 해야하는데, 패킷들이 클라이언트로 날아올 때, 이게 화상통화용 패킷인지, 게임용 패킷인지 알 수 없다. 이걸 구분하기 위해 PORT를 이용한다. IP는 목적지의 서버를 찾는 것이고, 같은 IP 내에서 돌아가는 프로세스를 구분하기 위한 게 PORT이다. 예를 들어 게임은 8090에, 화상통화는 21000에, 웹 브라우저는 10010에 PORT를 열어서 연결해 놓는다. 만약 내가 웹 브라우저에 요청을 보낸다면, IP 주소가 200.200.200.3에 80 포트에 메세지를 보낸다. 그러면 서버는 결과인 HTML 자료를 만들어서 내 IP주소인 100.100.100.1에 10010포트에 보낸다.

---

<br />

#### 5. DNS (도메인 네임 시스템)

IP는 기억하기 어려우며 변경될 수 있다. DNS는 중간에 전화번호부같은 서버를 제공한다. 도메인 명을 등록하여 IP 주소로 바꿀 수 있다.

예를 들어 구글이 DNS 서버에 도메인을 등록한다. 그리고 나는 DNS 서버에 구글의 도메인명으로 접근해서 DNS 서버한테 구글의 IP를 알려달라고 한다. 그러면 받은 IP 주소로 서버에 접근한다. 만약 IP가 변경되어도 앞과 같은 방식으로 접근 가능하다.

---

<br />

#### 6. 총정리

인터넷 네트워크 정리. 복잡한 인터넷망에 메세지를 보내기 위해서는 IP가 있어야 한다. 근데 이걸로는 불안하니 TCP가 해결해준다. 그리고 UPD는 IP와 거의 유사한 백지인데 거기에 PORT만 추가된 것. 그리고 필요하면 UDP 프로토콜에 애플리케이션을 더해서 기능을 확장할 수 있다. PORT는 같은 IP안에서 동작하는 애플리케이션을 통신할 때 구분하기 위한 것. DNS는 IP는 변하기 쉽고 기억하기 어려운데 도메인명을 등록하면 편하게 쓸 수 있다.
