### TCP, UDP

<br />

이러한 문제점을 TCP 프로토콜이 해결할 수 있다. IP 위에 TCP를 올려 살짝 보완해준다고 보면 된다.

친구한데 메세지를 보낸다고 가정하자. 그러면 애플리케이션인 채팅 프로그램을 통해 메시지를 생성한다. 그러면 메세지를 SOCKET 라이브러리를 통해 OS(운영체제) 계층에 전달한다. OS 계층에서 TCP는 메세지에다가 TCP 정보를 씌우고(초록색) 한칸 아래로 내려간다. TCP 계층 밑에는 IP 계층이 있다. 여기서 IP는 IP관련 정보를 그 위에 씌워서(노란색) 이렇게 IP 패킷이 생성된다. 그리고 네트워크 인터페이스 계층의 랜카드를 통해서 나갈 때, 이더넷 프레임(Ethernet frame)이 포함되서 나간다. 이더넷 프레임은 랜카드에 등록된 맥주소와 같은 물리적인 정보를 포함하고 있다.

IP 패킷에는 출발지IP, 목적지IP 등이 있고, 그 안에 있는 TCP 패킷에는 IP에선 없던 출발지 PORT, 목적지 PORT, 전송제어, 순서, 검증 정보, 그리고 그 안에 실제 전송 정보가 있다.

<br />

#### 1. TCP 프로토콜의 특징

TCP의 특징을 우선 살펴보자. TCP는 전송 제어 프로토콜이다. 여기에는 크게 세 가지 특징이 있는데,

1. 연결 지향 - TCP 3 way handshake(가상 연결)

   - 메세지를 먼저 보내는 게 아니라, 연결부터 해서 연결 여부를 살펴본 다음 메세지를 보낸다.

2. 데이터 전달 보증

   - 만약 메세지를 잘 받았다면 서버가 클라이언트한테 메세지 받았다고 알려줌
   - 만약 패킷이 중간에 누락된다면 그 사실을 알 수 있다.

3. 순서 보장

4. 신뢰할 수 있는 프로토콜
5. 현재는 대부분 TCP 사용

<br />

##### 1-1. 연결 지향 - TCP 3 way handshake(가상 연결)

우선 클라이언트에서 서버로 SYN 이란 접속 요청 메세지를 보낸다. 그러면 서버에서 요청을 수락했다는 ACK라는 메세지와 함께 '나도 연결해줘!'라는 SYN를 클라이언트에 보낸다. 그러면 클라이언트도 ACK를 보낸다. 이렇게 서로 연결이 되면 그 다음에 데이트를 전송한다. (요즘은 3번 ACK와 함께 바로 데이터를 전송하기도 한다) 그런데 이 쓰리 위에 핸드섀이크는 실제로 연결되는 게 아니라 개념적으로, 논리적으로 연결이 된 것. 실제로 수많은 서버의 노드들이 연결이 되었는지는 여부는 모른다. 그냥 연결이 됐다고 하니 '아, 연결 됐겠네' 라고 생각하는 것.

<br />

##### 1-3. 순서 보장

패킷 1,2,3 순서로 가야하는데 1,3,2로 갔다. 그러면 서버는 '2번부터 잘못됐구나' 싶어서 잘못 전송된 2번부터 폐기한 후, 클라이언트한테 다시 패킷2번부터 다시 보내라고 요청한다.
(물론 알아서 순서대로 조절을 한다던가 제대로 전송된 것들은 따로 보관하는 등 최적화를 할 수도 있다.)

---

<br />

#### 2. UDP 특징

사용자 데이터그램 프로토콜. UDP는 TCP와 같은 계층에 있고 IP 바로 위에 있다. UPD는 별다른 기능이 없다. 거의 IP와 비슷하다. 다만 거기에 PORT와 체크섬이 추가된다. PORT란 무엇일까? 예를 들어 한 컴퓨터에 게임과 음악 스트리밍을 돌린다고 가정하자. 내 컴퓨터는 하나라서 IP는 단 하나이다. 그런데 이 하나의 IP에 여러가지 패킷이 들어오게 된다. 여기서 애플리케이션들이 게임용이나 음악용 패킷을 구분하기 위해 PORT를 이용한다. 체크섬은 메세지에 대해서 맞는지 제대로 검증해주는 역할을 한다. TCP는 쓰리웨이 섀이킹을 해야하니 시간이 많이 걸리고 데이터 양도 커서 전송 속도가 빠를 수 없다. 이럴 때 UDP를 통하면 최적화를 할 수 있다. 현재는 TCP가 거의 대부분을 차지하고 있지만 최근에는 UDP가 각광받고 있다. 최근에 HTTP3 스펙이 나왔는데 여기서 SYN과 ACK를 줄여보자는 최적화를 하면서 UDP를 쓰고 있는데 그래서 뜨고 있다.

<br />
