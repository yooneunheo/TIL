## 04. 브라우저 런타임 환경 이해

<br>

자바 스크립트 런타임 환경에서는 자바 스크립트만으로 할 수 있는 것이 너무 한정적이다. 하지만 <b>브라우저에서 제공하는 웹 APIs는 브라우저의 멀티 쓰레딩을 이용해서 다양한 일들을 동시에 할 수 있다</b>.

그렇다면 웹 APIs와 자바 스크립트 엔진은 어떤 식으로 대화하면서 일들을 수행하는 걸까?

---

예를 들어 second() 안의 setTimeOut을 호출했다고 가정하자.

![04](https://user-images.githubusercontent.com/75867748/109419182-8fc3bd00-7a0f-11eb-9735-c73140aeb969.png)

setTimeout을 호출하는 순간 setTimeOut은 콜백에서 지워지고 웹 API는 타이머를 시작하게 된다.

![05](https://user-images.githubusercontent.com/75867748/109419183-90f4ea00-7a0f-11eb-8214-8a3d6d5c7923.png)

이렇게 타이머가 실행되는 동안 타이머와 자바 스크립트 엔진은 병렬적으로 실행되고 있다가 지정된 시간이 끝나면 웹 API는 task queue에 "타이머 끝났어. 여기 네가 등록한 콜백이야"라며 이 콜백 자체를 태스크 큐에 집어넣는다. 다시 말해, <B>웹 APIs는 우리가 등록한 콜백함수를 원하는 때 지정된 시간에 알아서 태스크 큐에 집어넣는다</b>.

![06](https://user-images.githubusercontent.com/75867748/109419187-92bead80-7a0f-11eb-9dbd-8e066b386bdc.png)

<br>

##### 태스크 큐

- FIFO(First In First Out)

<br>

##### 이벤트 루프

- 태스크 큐와 콜 스택을 관찰
- 이벤트 루프는 빙글빙글 돌면서 이 둘을 관찰한다
- 콜 스택이 비워지면 태스크 큐에 있던 걸 콜 스택으로 가져와서 자바 스크립트 엔진이 수행할 수 있도록 돕는다

![07](https://user-images.githubusercontent.com/75867748/109419188-92bead80-7a0f-11eb-9316-a270e7a3ffcc.png)
![08](https://user-images.githubusercontent.com/75867748/109419189-93574400-7a0f-11eb-892e-bb86e099e1ae.png)

<br>

---

#### 정리

자바 스크립트 엔진에는 메모리 힙과 콜 스택이 있다.
자바 스크립트 런타임 환경에는 태스크 큐라는 것이 있는데 바로 웹 APIs에서 우리가 등록한 콜백을 특정한 이벤트가 발생하게 되면 태스크 큐에 넣어서 이 이벤트 루프라는 아이가 계속 감시하면서 콜 스택이 비어져 있을 때 태스크 큐에 있는 아이를 하나씩 콜 스택으로 가져온다. 콜 스택에서 현재 수행 중인 아이는 끝날 때까지 보장이 된다. 즉 그 중간에 다른 태스크나 다른 일들을 할 수 없고 지금 수행 중인 그 코드 블럭이 끝날 때까지 이벤트 루프가 기다렸다가 다음에 다른 밑에 있는 콜스택이 수행되거나 태스크 큐에 있는 아이가 실행된다.
